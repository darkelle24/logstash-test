input {
  s3 {
    region => "eu-west-1"
    access_key_id => "${AWS_ID}"
    secret_access_key => "${AWS_KEY}"
    bucket => "logs.dev.deepbloo.com"
    include_object_properties => true
  }
}

filter {
  json {
    source => "message"
    target => "logs"
  }
  mutate {
    remove_field => [ "message" ]
    add_field => { "last_modified" => "%{[@metadata][s3][last_modified]}" }
  }
  split {
    field => "[@metadata][s3][key]"
    target => "temp"
    terminator => "/"
  }
  mutate {
    add_field => { "s3_folder_name" => "[temp][0]" }
  }
  mutate {
    remove_field => [ "temp" ]
  }
}

output {
    stdout {}
#   elasticsearch {
#       cloud_id => "${ELASTIC_ID_DEEP_LOGS}"
#       cloud_auth => "${ELASTIC_AUTH_DEEP_LOGS}"
#       index => "log-back-http-request-%{[request][node-env]}"
#     }
}